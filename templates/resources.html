{% extends "layout.html" %}
{% block content %}

<section class="section">
  <div class="container" id="expectations-box">
    <!-- Spinner while loading -->
    <div class="has-text-centered" id="loading-spinner">
      <span class="icon is-large">
        <i class="nf nf-dev-spinner nf-pulse nf-3x"></i>
      </span>
      <p>Loading Raider Expectations...</p>
    </div>

    <!-- Content will be injected here -->
    <div id="expectations-content" class="fade-in"></div>
  </div>
</section>

<!-- Useful links to wowaudit pages -->
<div class="container is-flex is-justify-content-center is-align-items-center is-flex-wrap-wrap"
     style="gap:10px; margin-top:20px; margin-bottom:70px;">

  <a class="button is-link is-outlined is-clickable"
     href="https://wowaudit.com/sheet/us/stormrage/seems-good/main">
    <span class="icon">
      <i class="nf nf-md-microsoft_excel"></i>
    </span>
    <span>View Spreadsheet</span>
  </a>

  <a class="button is-link is-outlined is-clickable"
     href="https://www.wowaudit.com/us/stormrage/seems-good/main/neighborhood?map_id=1&layer_index=0">
    <span class="icon">
      <i class="nf nf-fa-house_chimney"></i>
    </span>
    <span>Neighborhood Planner</span>
  </a>

  <a class="button is-link is-outlined is-clickable"
     href="https://www.wowaudit.com/us/stormrage/seems-good/main/wishlists/loot_history">
    <span class="icon">
      <i class="nf nf-fa-history"></i>
    </span>
    <span>Loot History</span>
  </a>
</div>

<script>
/* Load expectations content */
async function loadExpectations() {
  const spinner = document.getElementById('loading-spinner');
  const contentDiv = document.getElementById('expectations-content');

  try {
    const res = await fetch('/expectations');
    if (!res.ok) throw new Error(`HTTP error! status: ${res.status}`);
    let html = await res.text();

    const parser = new DOMParser();
    const doc = parser.parseFromString(html, 'text/html');

    contentDiv.innerHTML = doc.body.innerHTML;
    spinner.style.display = 'none';
    requestAnimationFrame(() => contentDiv.classList.add('visible'));


  } catch (err) {
    console.error('Failed to load expectations:', err);
    spinner.style.display = 'none';
    contentDiv.innerHTML = '<p>Content unavailable.</p>';
    contentDiv.classList.add('visible');
  }
}

document.addEventListener('DOMContentLoaded', loadExpectations);
</script>

{% endblock %}

